ROUTINE day04b
 ;day04.txt
 K  S B=+$G(B),C='B,D=C+C,Q=$E($ZV,D),F=$E($T(+C),D+C,*),$ZT=Q,P=$E(C/D)
 O F:Q U F F  R S I $I(I) F J=C:C:$L(S) S A(I,J)=$S($E(S,J)=P:B,C:C)
R C F S X=B F K=C:C:I F L=C:C:J S V=B D  S B(K,L)=V
 . F Y=-C,B,C F Z=-C,B,C S:'(Y=B&(Z=B)) V=V+$G(A(K+Y, L+Z))
 F K=C:C:I F L=C:C:J D:(A(K,L))&&(B(K,L)<(D+D))
 . S A(K,L)=B D $I(X) D $I(R)
 G:'X S G R
S W R,!